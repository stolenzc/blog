<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/blog2_32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/blog2_16x16.ico">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.stolenzc.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一个热爱技术的Python开发者">
<meta property="og:type" content="website">
<meta property="og:title" content="stolen&#39;s blog">
<meta property="og:url" content="https://blog.stolenzc.com/index.html">
<meta property="og:site_name" content="stolen&#39;s blog">
<meta property="og:description" content="一个热爱技术的Python开发者">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="stolen">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blog.stolenzc.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>stolen's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">stolen's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">逆风的方向，更适合飞翔</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-首页">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-归档">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-关于">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.stolenzc.com/2022/python_3_11_feature/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="stolen">
      <meta itemprop="description" content="一个热爱技术的Python开发者">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stolen's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/python_3_11_feature/" class="post-title-link" itemprop="url">Python3.11 新特性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-19 15:37:25" itemprop="dateCreated datePublished" datetime="2022-09-19T15:37:25+08:00">2022-09-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-23 09:29:00" itemprop="dateModified" datetime="2022-11-23T09:29:00+08:00">2022-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Python3.11 正式版在2022年10月25日发布了，主要更新了错误提示、异常处理和类型系统进行了更新</p>
<p>Python3.11 在性能方面较 Python3.10 快大约10%-60%，平均快大概25%</p>
<p>官方新特性链接 <a href="https://docs.python.org/zh-cn/3.11/whatsnew/3.11.html" target="_blank" rel="noopener">Python3.11 新特性</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>此处主要介绍在Ubuntu下安装 Python3.11</p>
<ol>
<li>添加deadsnakes源<ul>
<li><code>sudo add-apt-repository ppa:deadsnakes/ppa</code></li>
<li><code>sudo apt-get update</code></li>
</ul>
</li>
<li>安装 Python3.11<ul>
<li><code>sudo apt install python3.11</code></li>
</ul>
</li>
</ol>
<h2 id="报错提示"><a href="#报错提示" class="headerlink" title="报错提示"></a>报错提示</h2><h3 id="ZeroDivisionError"><a href="#ZeroDivisionError" class="headerlink" title="ZeroDivisionError"></a>ZeroDivisionError</h3><p>示例代码：<code>print(5/0)</code></p>
<p>特性内容：3.11会在出错的位置增加了一个波浪符号</p>
<p>Python3.10</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/home/project/demo.py"</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="built_in">print</span>(5/0)</span><br><span class="line">ZeroDivisionError: division by zero</span><br></pre></td></tr></table></figure>

<p>Python3.11</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/home/project/demo.py"</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="built_in">print</span>(5/0)</span><br><span class="line">          ~^~</span><br><span class="line">ZeroDivisionError: division by zero</span><br></pre></td></tr></table></figure>

<h3 id="KeyError"><a href="#KeyError" class="headerlink" title="KeyError"></a>KeyError</h3><p>示例代码：<code>{&#39;a&#39;: 1}[&#39;b&#39;][&#39;a&#39;]</code></p>
<p>特性内容：3.11 会在出错字典下划波浪线，并且突出指出出错的key</p>
<p>Python3.10</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/home/project/demo.py"</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    &#123;<span class="string">'a'</span>: 1&#125;[<span class="string">'b'</span>][<span class="string">'a'</span>]</span><br><span class="line">KeyError: <span class="string">'b'</span></span><br></pre></td></tr></table></figure>

<p>Python3.11</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/home/project/demo.py"</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    &#123;<span class="string">'a'</span>: 1&#125;[<span class="string">'b'</span>][<span class="string">'a'</span>]</span><br><span class="line">    ~~~~~~~~^^^^^</span><br><span class="line">KeyError: <span class="string">'b'</span></span><br></pre></td></tr></table></figure>

<h3 id="IndexError"><a href="#IndexError" class="headerlink" title="IndexError"></a>IndexError</h3><p>示例代码：<code>[1, 2, 3][3]</code></p>
<p>特性内容：3.11 会在出错列表下划波浪线，并且突出指出出错的index</p>
<p>Python3.10</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/home/project/demo.py"</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    [1, 2, 3][3]</span><br><span class="line">IndexError: list index out of range</span><br></pre></td></tr></table></figure>

<p>Python3.11</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/home/project/demo.py"</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    [1, 2, 3][3]</span><br><span class="line">    ~~~~~~~~~^^^</span><br><span class="line">IndexError: list index out of range</span><br></pre></td></tr></table></figure>

<h2 id="异常组和异常上下文"><a href="#异常组和异常上下文" class="headerlink" title="异常组和异常上下文"></a>异常组和异常上下文</h2><h3 id="异常组"><a href="#异常组" class="headerlink" title="异常组"></a>异常组</h3><p>在 Python3.11 中增加了异常组 <code>ExceptionGroup</code> 的概念，能够一次返回多个异常</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">raise</span> ExceptionGroup(</span><br><span class="line">        <span class="string">"多个异常"</span>,</span><br><span class="line">        [</span><br><span class="line">            TypeError(<span class="string">"type error"</span>),</span><br><span class="line">            ValueError(<span class="string">"value error"</span>),</span><br><span class="line">            KeyError(<span class="string">"key error"</span>)</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">test()</span><br></pre></td></tr></table></figure>

<p>输出错误信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+ Exception Group Traceback (most recent call last):</span><br><span class="line">|   File <span class="string">"/home/project/demo.py"</span>, line 11, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">|     <span class="built_in">test</span>()</span><br><span class="line">|   File <span class="string">"/home/project/demo.py"</span>, line 2, <span class="keyword">in</span> <span class="built_in">test</span></span><br><span class="line">|     raise ExceptionGroup(</span><br><span class="line">| ExceptionGroup: 多个异常 (3 sub-exceptions)</span><br><span class="line">+-+---------------- 1 ----------------</span><br><span class="line">  | TypeError: <span class="built_in">type</span> error</span><br><span class="line">  +---------------- 2 ----------------</span><br><span class="line">  | ValueError: value error</span><br><span class="line">  +---------------- 3 ----------------</span><br><span class="line">  | KeyError: <span class="string">'key error'</span></span><br><span class="line">  +------------------------------------</span><br></pre></td></tr></table></figure>

<p>注意</p>
<ul>
<li><code>ExceptionGroup</code> 可以继续嵌套 <code>ExceptionGroup</code></li>
<li><code>ExceptionGroup</code> 需要使用 <code>ExceptionGroup</code> 来捕捉错误，也可以使用 <code>except*</code> 来捕捉</li>
<li><code>ExceptionGroup</code> 继承自 <code>Exception</code> ，故可使用 <code>Exception</code> 来捕捉错误</li>
</ul>
<h3 id="except"><a href="#except" class="headerlink" title="except*"></a>except*</h3><p><code>except*</code> 用于一次匹配到多个异常，主要用于对 <code>ExceptionGroup</code> 进行错误捕捉</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">    <span class="keyword">raise</span> ExceptionGroup(</span><br><span class="line">        <span class="string">"多个异常"</span>,</span><br><span class="line">        [</span><br><span class="line">            TypeError(<span class="string">"type error"</span>),</span><br><span class="line">            ValueError(<span class="string">"value error"</span>),</span><br><span class="line">            KeyError(<span class="string">"key error"</span>)</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">except</span>* TypeError:</span><br><span class="line">    print(<span class="string">'捕捉到TypeError'</span>)</span><br><span class="line"><span class="keyword">except</span>* ValueError:</span><br><span class="line">    print(<span class="string">'捕捉到ValueError'</span>)</span><br><span class="line"><span class="keyword">except</span>* KeyError:</span><br><span class="line">    print(<span class="string">'捕捉到KeyError'</span>)</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">捕捉到TypeError</span><br><span class="line">捕捉到ValueError</span><br><span class="line">捕捉到KeyError</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>:</p>
<ul>
<li>如果没有完全捕捉 <code>ExceptionGroup</code> 中的所有错误，则还是会抛出错误</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">    <span class="keyword">raise</span> ExceptionGroup(</span><br><span class="line">        <span class="string">"多个异常"</span>,</span><br><span class="line">        [</span><br><span class="line">            TypeError(<span class="string">"type error"</span>),</span><br><span class="line">            ValueError(<span class="string">"value error"</span>),</span><br><span class="line">            KeyError(<span class="string">"key error"</span>)</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">except</span>* TypeError:</span><br><span class="line">    print(<span class="string">'捕捉到TypeError'</span>)</span><br><span class="line"><span class="keyword">except</span>* ValueError:</span><br><span class="line">    print(<span class="string">'捕捉到ValueError'</span>)</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">捕捉到TypeError</span><br><span class="line">捕捉到ValueError</span><br><span class="line">  + Exception Group Traceback (most recent call last):</span><br><span class="line">  |   File <span class="string">"/home/project/demo.py"</span>, line 20, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  |     main()</span><br><span class="line">  |   File <span class="string">"/home/project/demo.py"</span>, line 14, <span class="keyword">in</span> main</span><br><span class="line">  |     <span class="built_in">test</span>()</span><br><span class="line">  |   File <span class="string">"/home/project/demo.py"</span>, line 2, <span class="keyword">in</span> <span class="built_in">test</span></span><br><span class="line">  |     raise ExceptionGroup(</span><br><span class="line">  | ExceptionGroup: 多个异常 (1 sub-exception)</span><br><span class="line">  +-+---------------- 1 ----------------</span><br><span class="line">    | KeyError: <span class="string">'key error'</span></span><br><span class="line">    +------------------------------------</span><br></pre></td></tr></table></figure>

<h3 id="增强异常的注释"><a href="#增强异常的注释" class="headerlink" title="增强异常的注释"></a>增强异常的注释</h3><p>在 Python3.11 中，内置了一个方式来向异常中增加备注信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> typer</span><br><span class="line"><span class="keyword">except</span> ModuleNotFoundError <span class="keyword">as</span> e:</span><br><span class="line">    e.add_note(<span class="string">"你还没有安装 typer"</span>)</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>

<h2 id="TOML解析器"><a href="#TOML解析器" class="headerlink" title="TOML解析器"></a>TOML解析器</h2><p>在 Python3.11 中内置了一个 <code>tomllib</code> 模块进行toml解析，主要提供两个方法 <code>load</code> 和 <code>loads</code></p>
<ul>
<li><code>load</code> 主要用来读取文件内容并解析，注意文件需要以二进制形式 <code>rb</code> 打开</li>
<li><code>loads</code> 主要用来解析toml字符串内容</li>
</ul>
<p>示例1：</p>
<p>新建一个 <code>config.toml</code> 文件，写入一下内容</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Params]</span></span><br><span class="line">  foo = 'bar'</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tomllib</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'./config.toml'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    config = tomllib.load(f)</span><br><span class="line">    print(config)</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'Params'</span>: &#123;<span class="string">'foo'</span>: <span class="string">'bar'</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>示例2：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tomllib</span><br><span class="line"></span><br><span class="line">toml_str = <span class="string">"""</span></span><br><span class="line"><span class="string">[Params]</span></span><br><span class="line"><span class="string">  foo = 'bar'</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">print(tomllib.loads(toml_str))</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'Params'</span>: &#123;<span class="string">'foo'</span>: <span class="string">'bar'</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="类型注解"><a href="#类型注解" class="headerlink" title="类型注解"></a>类型注解</h2><p>Python3.11 主要新增了 <code>TypeVarTuple</code> 、 <code>TypeGuard</code> 、 <code>Self</code> 、 <code>LiteralString</code> 、 <code>Required</code> 、 <code>NotRequired</code> 等类型</p>
<h3 id="Self"><a href="#Self" class="headerlink" title="Self"></a>Self</h3><p>新的 Self 注释提供了一种简单直观的方法来注释返回类实例的方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLock</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span> -&gt; Self:</span></span><br><span class="line">        self.lock()</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInt</span>:</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fromhex</span><span class="params">(cls, s: str)</span> -&gt; Self:</span></span><br><span class="line">        <span class="keyword">return</span> cls(int(s, <span class="number">16</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Required-和-NotRequired"><a href="#Required-和-NotRequired" class="headerlink" title="Required 和 NotRequired"></a>Required 和 NotRequired</h3><p>在使用 <code>dataclass</code> 装饰类的时候，可以指定参数是否必传</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span><span class="params">(TypedDict, total=False)</span>:</span></span><br><span class="line">   title: Required[str]</span><br><span class="line">   year: int</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.stolenzc.com/2022/python_3_10_feature/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="stolen">
      <meta itemprop="description" content="一个热爱技术的Python开发者">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stolen's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/python_3_10_feature/" class="post-title-link" itemprop="url">Python3.10 新特性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-19 15:27:40" itemprop="dateCreated datePublished" datetime="2022-09-19T15:27:40+08:00">2022-09-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-23 09:29:00" itemprop="dateModified" datetime="2022-11-23T09:29:00+08:00">2022-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Python3.10 发布于2021年10月14日，这儿总结一下改版本引入的一些新功能</p>
<p>官方新特性链接 <a href="https://docs.python.org/zh-cn/3.10/whatsnew/3.10.html" target="_blank" rel="noopener">Python3.10 新特性</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>此处主要介绍在Ubuntu下安装 Python3.10</p>
<ol>
<li>添加deadsnakes源<ul>
<li><code>sudo add-apt-repository ppa:deadsnakes/ppa</code></li>
<li><code>sudo apt-get update</code></li>
</ul>
</li>
<li>安装 Python3.10<ul>
<li><code>sudo apt install python3.10-full</code></li>
</ul>
</li>
<li>安装 Python3.10 的pip<ul>
<li><code>python3.10 -m ensurepip --upgrade</code></li>
</ul>
</li>
</ol>
<h2 id="结构模式匹配（match-case）"><a href="#结构模式匹配（match-case）" class="headerlink" title="结构模式匹配（match case）"></a>结构模式匹配（match case）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通用语法</span></span><br><span class="line"></span><br><span class="line">match subject:</span><br><span class="line">    case &lt;pattern_1&gt;:</span><br><span class="line">        &lt;action_1&gt;</span><br><span class="line">    case &lt;pattern_2&gt;:</span><br><span class="line">        &lt;action_2&gt;</span><br><span class="line">    case &lt;pattern_3&gt;:</span><br><span class="line">        &lt;action_3&gt;</span><br><span class="line">    case _:</span><br><span class="line">        &lt;action_wildcard&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">http_error</span><span class="params">(status)</span>:</span></span><br><span class="line">    match status:</span><br><span class="line">        case <span class="number">400</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Bad request"</span></span><br><span class="line">        case <span class="number">404</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Not found"</span></span><br><span class="line">        case <span class="number">418</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"I'm a teapot"</span></span><br><span class="line">        case <span class="number">455</span> | <span class="number">456</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"This is a custom error"</span></span><br><span class="line">        case _:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Something's wrong with the Internet"</span></span><br><span class="line"></span><br><span class="line">print(http_error(<span class="number">418</span>))</span><br><span class="line">print(http_error(<span class="number">455</span>))</span><br><span class="line">print(http_error(<span class="number">456</span>))</span><br><span class="line">print(http_error(<span class="number">499</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># I'm a teapot</span></span><br><span class="line"><span class="comment"># This is a custom error</span></span><br><span class="line"><span class="comment"># This is a custom error</span></span><br><span class="line"><span class="comment"># Something's wrong with the Internet</span></span><br></pre></td></tr></table></figure>

<p>带有字面值和变量的模式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># point is an (x, y) tuple</span></span><br><span class="line">match point:</span><br><span class="line">    case (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">        print(<span class="string">"Origin"</span>)</span><br><span class="line">    case (<span class="number">0</span>, y):</span><br><span class="line">        print(<span class="string">f"Y=<span class="subst">&#123;y&#125;</span>"</span>)</span><br><span class="line">    case (x, <span class="number">0</span>):</span><br><span class="line">        print(<span class="string">f"X=<span class="subst">&#123;x&#125;</span>"</span>)</span><br><span class="line">    case (x, y):</span><br><span class="line">        print(<span class="string">f"X=<span class="subst">&#123;x&#125;</span>, Y=<span class="subst">&#123;y&#125;</span>"</span>)</span><br><span class="line">    case _:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"Not a point"</span>)</span><br></pre></td></tr></table></figure>

<p>模式和类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>:</span></span><br><span class="line">    x: int</span><br><span class="line">    y: int</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">location</span><span class="params">(point)</span>:</span></span><br><span class="line">    match point:</span><br><span class="line">        case Point(x=<span class="number">0</span>, y=<span class="number">0</span>):</span><br><span class="line">            print(<span class="string">"Origin is the point's location."</span>)</span><br><span class="line">        case Point(x=<span class="number">0</span>, y=y):</span><br><span class="line">            print(<span class="string">f"Y=<span class="subst">&#123;y&#125;</span> and the point is on the y-axis."</span>)</span><br><span class="line">        case Point(x=x, y=<span class="number">0</span>):</span><br><span class="line">            print(<span class="string">f"X=<span class="subst">&#123;x&#125;</span> and the point is on the x-axis."</span>)</span><br><span class="line">        case Point():</span><br><span class="line">            print(<span class="string">"The point is located somewhere else on the plane."</span>)</span><br><span class="line">        case _:</span><br><span class="line">            print(<span class="string">"Not a point"</span>)</span><br></pre></td></tr></table></figure>

<p>约束项</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">match point:</span><br><span class="line">    case Point(x, y) <span class="keyword">if</span> x == y:</span><br><span class="line">        print(<span class="string">f"The point is located on the diagonal Y=X at <span class="subst">&#123;x&#125;</span>."</span>)</span><br><span class="line">    case Point(x, y):</span><br><span class="line">        print(<span class="string">f"Point is not on the diagonal."</span>)</span><br></pre></td></tr></table></figure>

<p>复杂模式和通配符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">match test_variable:</span><br><span class="line">    case (<span class="string">'warning'</span>, code, <span class="number">40</span>):</span><br><span class="line">        print(<span class="string">"A warning has been received."</span>)</span><br><span class="line">    case (<span class="string">'error'</span>, code, _):</span><br><span class="line">        print(<span class="string">f"An error <span class="subst">&#123;code&#125;</span> occurred."</span>)</span><br></pre></td></tr></table></figure>

<h2 id="更好的错误信息"><a href="#更好的错误信息" class="headerlink" title="更好的错误信息"></a>更好的错误信息</h2><h3 id="语法错误（SynaxErrors）"><a href="#语法错误（SynaxErrors）" class="headerlink" title="语法错误（SynaxErrors）"></a>语法错误（SynaxErrors）</h3><p>字典未关闭</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">test_dict = &#123;<span class="number">1</span>: <span class="number">1</span>, <span class="number">2</span>: <span class="number">2</span>, <span class="number">3</span>: <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.9</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">  File "/home/stolen/test.py", line 2</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">    ^</span></span><br><span class="line"><span class="string">SyntaxError: unexpected EOF while parsing</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.10</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">  File "/home/stolen/test.py", line 1</span></span><br><span class="line"><span class="string">    test_dict = &#123;1: 1, 2: 2, 3: 3</span></span><br><span class="line"><span class="string">                ^</span></span><br><span class="line"><span class="string">SyntaxError: '&#123;' was never closed</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<p>冒号缺失</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="number">1</span> &gt; <span class="number">2</span></span><br><span class="line">    print(<span class="string">'abc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.9</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">  File "/home/stolen/test.py", line 1</span></span><br><span class="line"><span class="string">    if 1 &gt; 2</span></span><br><span class="line"><span class="string">            ^</span></span><br><span class="line"><span class="string">SyntaxError: invalid syntax</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.10</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">  File "/home/stolen/test.py", line 1</span></span><br><span class="line"><span class="string">    if 1 &gt; 2</span></span><br><span class="line"><span class="string">            ^</span></span><br><span class="line"><span class="string">SyntaxError: expected ':'</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<p>判断等于错误</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> bool(<span class="number">3.14</span>) = <span class="literal">True</span>:</span><br><span class="line">    print(<span class="string">'true'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.9</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">  File "/home/stolen/test.py", line 1</span></span><br><span class="line"><span class="string">    if bool(3.14) = True:</span></span><br><span class="line"><span class="string">                  ^</span></span><br><span class="line"><span class="string">SyntaxError: invalid syntax</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.10</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">  File "/home/stolen/test.py", line 1</span></span><br><span class="line"><span class="string">    if bool(3.14) = True:</span></span><br><span class="line"><span class="string">       ^^^^^^^^^^</span></span><br><span class="line"><span class="string">SyntaxError: cannot assign to function call here. Maybe you meant '==' instead of '='?</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h3 id="缩进错误（IndentationErrors）"><a href="#缩进错误（IndentationErrors）" class="headerlink" title="缩进错误（IndentationErrors）"></a>缩进错误（IndentationErrors）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> bool(<span class="number">3.14</span>) == <span class="literal">True</span>:</span><br><span class="line">print(<span class="string">'true'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.9</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">  File "/home/project/demo.py", line 2</span></span><br><span class="line"><span class="string">    print('true')</span></span><br><span class="line"><span class="string">    ^</span></span><br><span class="line"><span class="string">IndentationError: expected an indented block</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.10</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">  File "/home/project/demo.py", line 2</span></span><br><span class="line"><span class="string">    print('true')</span></span><br><span class="line"><span class="string">    ^</span></span><br><span class="line"><span class="string">IndentationError: expected an indented block after 'if' statement on line 1</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h3 id="属性错误（AttributeErrors）"><a href="#属性错误（AttributeErrors）" class="headerlink" title="属性错误（AttributeErrors）"></a>属性错误（AttributeErrors）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">'abc'</span></span><br><span class="line">a.isnumerics()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.9</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">  File "/home/project/demo.py", line 2, in &lt;module&gt;</span></span><br><span class="line"><span class="string">    a.isnumerics()</span></span><br><span class="line"><span class="string">AttributeError: 'str' object has no attribute 'isnumerics'</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.10</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">  File "/home/project/demo.py", line 2, in &lt;module&gt;</span></span><br><span class="line"><span class="string">    a.isnumerics()</span></span><br><span class="line"><span class="string">AttributeError: 'str' object has no attribute 'isnumerics'. Did you mean: 'isnumeric'?</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h3 id="命名错误（NameErrors）"><a href="#命名错误（NameErrors）" class="headerlink" title="命名错误（NameErrors）"></a>命名错误（NameErrors）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">hello = <span class="string">'hello, world!'</span></span><br><span class="line">print(hallo)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.9</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">  File "/home/project/demo.py", line 2, in &lt;module&gt;</span></span><br><span class="line"><span class="string">    print(hallo)</span></span><br><span class="line"><span class="string">NameError: name 'hallo' is not defined</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.10</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">  File "/home/project/demo.py", line 2, in &lt;module&gt;</span></span><br><span class="line"><span class="string">    print(hallo)</span></span><br><span class="line"><span class="string">NameError: name 'hallo' is not defined. Did you mean: 'hello'?</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h2 id="类型提示相关的新功能"><a href="#类型提示相关的新功能" class="headerlink" title="类型提示相关的新功能"></a>类型提示相关的新功能</h2><p>从 Python3.5 开始正式引入 typing 模块，从 Python3.6 开始已经获得全面的类型声明的支持，一下将介绍 Python3.10 中的变化</p>
<h3 id="Union-可以用-简写"><a href="#Union-可以用-简写" class="headerlink" title="Union 可以用 | 简写"></a>Union 可以用 <code>|</code> 简写</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python3.9</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Union</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span><span class="params">(number: Union[int, float])</span> -&gt; Union[int, float]:</span></span><br><span class="line">    <span class="keyword">return</span> number ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.10</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span><span class="params">(number: int | float)</span> -&gt; int | float:</span></span><br><span class="line">    <span class="keyword">return</span> number ** <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>这种语法也可以用在 isinstance 中 <code>isinstance(item, int | str)</code></p>
<h3 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h3><p>现在可以对类型别名变量做TypeHint</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python3.9</span></span><br><span class="line">MyType = str</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(something: MyType)</span> -&gt; MyType:</span></span><br><span class="line">    <span class="keyword">return</span> something</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.10</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeAlias</span><br><span class="line">MyType: TypeAlias = str</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(something: MyType)</span> -&gt; MyType:</span></span><br><span class="line">    <span class="keyword">return</span> something</span><br></pre></td></tr></table></figure>

<h2 id="带括号的上下文管理器"><a href="#带括号的上下文管理器" class="headerlink" title="带括号的上下文管理器"></a>带括号的上下文管理器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> (CtxManager() <span class="keyword">as</span> example):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> (</span><br><span class="line">    CtxManager1(),</span><br><span class="line">    CtxManager2()</span><br><span class="line">):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> (CtxManager1() <span class="keyword">as</span> example,</span><br><span class="line">      CtxManager2()):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> (CtxManager1(),</span><br><span class="line">      CtxManager2() <span class="keyword">as</span> example):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> (</span><br><span class="line">    CtxManager1() <span class="keyword">as</span> example1,</span><br><span class="line">    CtxManager2() <span class="keyword">as</span> example2</span><br><span class="line">):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h2 id="zip的长度检查"><a href="#zip的长度检查" class="headerlink" title="zip的长度检查"></a>zip的长度检查</h2><p>默认情况下 zip 在最短的迭代次数用尽时停止，现在加入了一个 <code>strict=False</code> 参数，默认情况不检查长度，如果 <code>strict=True</code> 时，如果可迭代项长度不相等，则会引发 <code>ValueError</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">list(zip(range(<span class="number">3</span>), [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], strict=<span class="literal">True</span>))</span><br><span class="line"><span class="comment"># [(0, 'a'), (1, 'b'), (2, 'c')]</span></span><br><span class="line"></span><br><span class="line">list(zip(range(<span class="number">3</span>), [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], strict=<span class="literal">True</span>))</span><br><span class="line"><span class="comment"># ValueError: zip() argument 2 is longer than argument 1</span></span><br></pre></td></tr></table></figure>

<h2 id="字典视图映射"><a href="#字典视图映射" class="headerlink" title="字典视图映射"></a>字典视图映射</h2><p>字典的三个方法 dict.keys()、dict.values() 和 dict.items() 会返回不同的视图，现在都增加了 mapping 属性，可以返回原始字典。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data=&#123;<span class="string">'python'</span>:<span class="number">2021</span>,<span class="string">'java'</span>:<span class="number">2020</span>&#125;</span><br><span class="line">k=data.keys()</span><br><span class="line">print(k)</span><br><span class="line">print(k.mapping)</span><br><span class="line"></span><br><span class="line"><span class="comment"># dict_keys(['python', 'java'])</span></span><br><span class="line"><span class="comment"># &#123;'python': 2021, 'java': 2020&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="为整数添加-popcount-计算方法"><a href="#为整数添加-popcount-计算方法" class="headerlink" title="为整数添加 popcount 计算方法"></a>为整数添加 popcount 计算方法</h2><p>汉明重量是一串符号中非零符号的个数,是以理查德·卫斯里·汉明的名字命名的，它在包括信息论、编码理论、密码学等多个领域都有应用。</p>
<p>在密码学以及其它应用中经常需要计算数据位中 1 的个数，针对如何高效地实现人们已经广泛地进行了研究。</p>
<p>Python3.10 为整数类型增加了一个新方法 int.bit_count() 可以返回给定整数的二进制位中 1 的个数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">11</span></span><br><span class="line">print(bin(a))    <span class="comment">#a的二进制表示</span></span><br><span class="line">print(a.bit_count())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0b1011</span></span><br><span class="line"><span class="comment"># 3</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.stolenzc.com/2022/python_3_9_feature/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="stolen">
      <meta itemprop="description" content="一个热爱技术的Python开发者">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stolen's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/python_3_9_feature/" class="post-title-link" itemprop="url">Python3.9 新特性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-19 14:08:59" itemprop="dateCreated datePublished" datetime="2022-09-19T14:08:59+08:00">2022-09-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-23 09:29:00" itemprop="dateModified" datetime="2022-11-23T09:29:00+08:00">2022-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Python3.9 发布于2020年10月5日，这儿总结一下改版本引入的一些新功能</p>
<p>官方新特性链接 <a href="https://docs.python.org/zh-cn/3.9/whatsnew/3.9.html" target="_blank" rel="noopener">Python3.9 新特性</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>此处主要介绍在Ubuntu下安装 Python3.9</p>
<ol>
<li>添加deadsnakes源<ul>
<li><code>sudo add-apt-repository ppa:deadsnakes/ppa</code></li>
<li><code>sudo apt-get update</code></li>
</ul>
</li>
<li>安装 Python3.9<ul>
<li><code>sudo apt install python3.9-full</code></li>
</ul>
</li>
<li>安装 Python3.9 的pip<ul>
<li><code>python3.9 -m ensurepip --upgrade</code></li>
</ul>
</li>
</ol>
<h2 id="字典合并与更新运算符"><a href="#字典合并与更新运算符" class="headerlink" title="字典合并与更新运算符"></a>字典合并与更新运算符</h2><p>合并 (<code>|</code>) 与更新 (<code>|=</code>) 运算符已被加入内置的 dict 类。 它们为现有的 <code>dict.update</code> 和 <code>{**d1, **d2}</code> 字典合并方法提供了补充。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">x = &#123;<span class="string">"key1"</span>: <span class="string">"value1 from x"</span>, <span class="string">"key2"</span>: <span class="string">"value2 from x"</span>&#125;</span><br><span class="line">y = &#123;<span class="string">"key2"</span>: <span class="string">"value2 from y"</span>, <span class="string">"key3"</span>: <span class="string">"value3 from y"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并</span></span><br><span class="line"><span class="comment"># z = &#123;**x, **y&#125;</span></span><br><span class="line">z = x | y</span><br><span class="line"><span class="comment"># 如果两个字典都存在key，则保留后面的key的值，</span></span><br><span class="line"><span class="comment"># z: &#123;'key1': 'value1 from x', 'key2': 'value2 from y', 'key3': 'value3 from y'&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新</span></span><br><span class="line"><span class="comment"># x.update(y)</span></span><br><span class="line">x |= y</span><br><span class="line"><span class="comment"># x: &#123;'key1': 'value1 from x', 'key2': 'value2 from y', 'key3': 'value3 from y'&#125;</span></span><br><span class="line"><span class="comment"># 将y中的值更新到x中</span></span><br></pre></td></tr></table></figure>

<h2 id="放宽对装饰器的语法限制"><a href="#放宽对装饰器的语法限制" class="headerlink" title="放宽对装饰器的语法限制"></a>放宽对装饰器的语法限制</h2><p>在之前版本的 Python 中对于装饰器的语法是有所限制的，Python 3.9 终于将这一限制放宽任意，任何表达式都可以用在装饰器中。</p>
<p>之前的装饰器语法</p>
<p><code>decorator: &#39;@&#39; dotted_name [ &#39;(&#39; [arglist] &#39;)&#39; ] NEWLINE</code></p>
<p>Python3.9 的装饰器语法</p>
<p><code>decorator: &#39;@&#39; namedexpr_test NEWLINE</code></p>
<p>旧版装饰器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upper</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> func(*args).upper()</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@upper</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f'hello <span class="subst">&#123;name&#125;</span>'</span></span><br><span class="line"></span><br><span class="line">hello(<span class="string">'johnson'</span>)</span><br><span class="line"><span class="comment"># HELLO JOHNSON</span></span><br></pre></td></tr></table></figure>

<p>新版装饰器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@lambda func:(lambda *args:func(*args).upper())</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f'hello <span class="subst">&#123;name&#125;</span>'</span></span><br><span class="line"></span><br><span class="line">hello(<span class="string">'johnson'</span>)</span><br><span class="line"><span class="comment"># HELLO JOHNSON</span></span><br></pre></td></tr></table></figure>

<h2 id="新增用于移除前缀和后缀的字符串方法"><a href="#新增用于移除前缀和后缀的字符串方法" class="headerlink" title="新增用于移除前缀和后缀的字符串方法"></a>新增用于移除前缀和后缀的字符串方法</h2><p>增加了 <code>str.removeprefix(prefix)</code> 和 <code>str.removesuffix(suffix)</code> 用于方便地从字符串移除不需要的前缀或后缀。另外 <code>bytes</code> 和 <code>bytearray</code> 以及 <code>collections.UserString</code> 也增加了对应的方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str_hello = <span class="string">'hello, world!'</span></span><br><span class="line">no_prefix = str_hello.removeprefix(<span class="string">'hello,'</span>)</span><br><span class="line">no_suffix = str_hello.removesuffix(<span class="string">'world!'</span>)</span><br><span class="line"><span class="comment"># 该方法不会修改原始字符串，只会返回新的字符串</span></span><br></pre></td></tr></table></figure>

<h2 id="标准多项集中的类型标注泛型"><a href="#标准多项集中的类型标注泛型" class="headerlink" title="标准多项集中的类型标注泛型"></a>标准多项集中的类型标注泛型</h2><p><code>dict</code> 、 <code>list</code>、 <code>set</code>、 <code>tuple</code> 用于取代 typing 中的 <code>Dict</code>、 <code>List</code>、 <code>Set</code>、 <code>Tuple</code></p>
<p>之前的版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greet_all</span><span class="params">(names: List[str])</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">        print(<span class="string">"Hello"</span>, name)</span><br></pre></td></tr></table></figure>

<p>Python3.9 版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greet_all</span><span class="params">(names: list[str])</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">        print(<span class="string">"Hello"</span>, name)</span><br></pre></td></tr></table></figure>

<h2 id="file-属性将是一个绝对路径"><a href="#file-属性将是一个绝对路径" class="headerlink" title="file 属性将是一个绝对路径"></a><strong>file</strong> 属性将是一个绝对路径</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /home/stolen/test.py</span></span><br><span class="line">print(__file__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.8 输出</span></span><br><span class="line"><span class="comment"># test.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.9 输出</span></span><br><span class="line"><span class="comment"># /home/stolen/test.py</span></span><br></pre></td></tr></table></figure>

<h2 id="datetime-模块的改进"><a href="#datetime-模块的改进" class="headerlink" title="datetime 模块的改进"></a>datetime 模块的改进</h2><p>isocalendar() 方法现在返回 namedtuple (具名元组) ，这样可以通过属性也能访问到该值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">today = datetime.date.today().isocalendar()</span><br><span class="line">print(today)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.8</span></span><br><span class="line"><span class="comment"># (2022, 38, 1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.9</span></span><br><span class="line"><span class="comment"># datetime.IsoCalendarDate(year=2022, week=38, weekday=1)</span></span><br><span class="line"><span class="comment"># today.week -&gt; 38</span></span><br></pre></td></tr></table></figure>

<h2 id="math-模块的改进"><a href="#math-模块的改进" class="headerlink" title="math 模块的改进"></a>math 模块的改进</h2><p><code>math.gcd(*integers)</code> 求最大公约数的函数允许传入超过2个参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">result = math.gcd(<span class="number">6</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">18</span>)</span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.8</span></span><br><span class="line"><span class="comment"># TypeError: gcd expected 2 arguments, got 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.9</span></span><br><span class="line"><span class="comment"># 3</span></span><br></pre></td></tr></table></figure>

<p><code>math.lcm(*integer)</code> 新增计算最小公倍数函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">result = math.lcm(<span class="number">6</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">18</span>)</span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.8</span></span><br><span class="line"><span class="comment"># AttributeError: module 'math' has no attribute 'lcm'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3.9</span></span><br><span class="line"><span class="comment"># 180</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.stolenzc.com/2022/python_3_8_feature/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="stolen">
      <meta itemprop="description" content="一个热爱技术的Python开发者">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stolen's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/python_3_8_feature/" class="post-title-link" itemprop="url">Python3.8 新特性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-18 15:27:38" itemprop="dateCreated datePublished" datetime="2022-09-18T15:27:38+08:00">2022-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-23 09:29:00" itemprop="dateModified" datetime="2022-11-23T09:29:00+08:00">2022-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Python3.8 发布于2019年10月14日，这儿总结一下改版本引入的一些新功能</p>
<p>官方新特性链接 <a href="https://docs.python.org/zh-cn/3.8/whatsnew/3.8.html" target="_blank" rel="noopener">Python3.8 新特性</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>此处主要介绍在Ubuntu下安装 Python3.8</p>
<ol>
<li>添加deadsnakes源<ul>
<li><code>sudo add-apt-repository ppa:deadsnakes/ppa</code></li>
<li><code>sudo apt-get update</code></li>
</ul>
</li>
<li>安装 Python3.8<ul>
<li><code>sudo apt install python3.8-full</code></li>
</ul>
</li>
<li>安装 Python3.8 的pip<ul>
<li><code>python3.8 -m ensurepip --upgrade</code></li>
</ul>
</li>
</ol>
<h2 id="海象运算符"><a href="#海象运算符" class="headerlink" title="海象运算符"></a>海象运算符</h2><p>新增的语法 := 可在表达式内部为变量赋值。 它被昵称为“海象运算符”因为它很像是海象的眼睛和长牙。</p>
<p>例如以下代码可以避免 <code>len()</code> 调用两次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]</span><br><span class="line"><span class="keyword">if</span> (n := len(a)) &gt; <span class="number">10</span>:</span><br><span class="line">    print(<span class="string">f"List is too long (<span class="subst">&#123;n&#125;</span> elements, expected &lt;= 10)"</span>)</span><br></pre></td></tr></table></figure>

<p>利用海象表达式可以在一行内实现斐波那契数列</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(f:=(f[<span class="number">1</span>], sum(f)) <span class="keyword">if</span> i <span class="keyword">else</span> (<span class="number">0</span>,<span class="number">1</span>))[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br></pre></td></tr></table></figure>

<h2 id="仅限位置形参"><a href="#仅限位置形参" class="headerlink" title="仅限位置形参"></a>仅限位置形参</h2><p>新增了一个函数形参语法 <code>/</code> 用来指明某些函数形参必须使用仅限位置而非关键字参数的形式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(a, b, /, c, d, *, e, f)</span>:</span></span><br><span class="line">    print(a, b, c, d, e, f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 形参 a 和 b 为仅限位置形参</span></span><br><span class="line"><span class="comment"># c 或 d 可以是位置形参或关键字形参，也就是默认形式</span></span><br><span class="line"><span class="comment"># e 或 f 要求为仅限关键字形参</span></span><br></pre></td></tr></table></figure>

<h2 id="字典可使用-reversed-进行反转"><a href="#字典可使用-reversed-进行反转" class="headerlink" title="字典可使用 reversed 进行反转"></a>字典可使用 reversed 进行反转</h2><p>普通字典自 Python 3.7 起已保证具有确定的元素顺序，在 Python 3.8 中可以利用 reversed 按插入顺序反向迭代。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s=&#123;<span class="string">'a'</span>: <span class="number">1</span>,<span class="string">'b'</span>: <span class="number">2</span>,<span class="string">'c'</span>: <span class="number">3</span>&#125;</span><br><span class="line">print(list(reversed(s.items())))</span><br><span class="line"><span class="comment"># [('c', 3), ('b', 2), ('a', 1)]</span></span><br></pre></td></tr></table></figure>

<h2 id="f-string-增加-说明符"><a href="#f-string-增加-说明符" class="headerlink" title="f-string 增加 = 说明符"></a>f-string 增加 = 说明符</h2><p>增加 = 说明符用于 f-string。 形式为 f’{expr=}’ 的 f-字符串将扩展表示为表达式文本，加一个等于号，再加表达式的求值结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user = <span class="string">'eric_idle'</span></span><br><span class="line">member_since = date(<span class="number">1975</span>, <span class="number">7</span>, <span class="number">31</span>)</span><br><span class="line"><span class="string">f'<span class="subst">&#123;user=&#125;</span> <span class="subst">&#123;member_since=&#125;</span>'</span></span><br><span class="line"><span class="comment"># user='eric_idle' member_since=datetime.date(1975, 7, 31)</span></span><br></pre></td></tr></table></figure>

<p>新版本还给 f-string 增加了转换符 !s 、!a 、!r<br>转换符 <code>!s</code> 是对结果调用 str()，<code>!r</code> 是调用 repr()，而 <code>!a</code> 是调用 ascii()。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">today = datetime.date.today()</span><br><span class="line">print(<span class="string">f'今天是 <span class="subst">&#123;today!s&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'今天是 <span class="subst">&#123;today!r&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'今天是 <span class="subst">&#123;today!a&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="可从进程直接访问的共享内存"><a href="#可从进程直接访问的共享内存" class="headerlink" title="可从进程直接访问的共享内存"></a>可从进程直接访问的共享内存</h2><p>添加了新的 <code>multiprocessing.shared_memory</code> 模块，可以直接共享内存</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> shared_memory</span><br><span class="line">a = shared_memory.ShareableList([<span class="number">2021</span>, <span class="string">'abc'</span>, <span class="number">2022</span>])</span><br><span class="line">a</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> shared_memory</span><br><span class="line">b = shared_memory.ShareableList(name=)    <span class="comment">#这里要把获得的name值写入</span></span><br><span class="line">b</span><br></pre></td></tr></table></figure>

<h2 id="typing-特性"><a href="#typing-特性" class="headerlink" title="typing 特性"></a>typing 特性</h2><p>新增 <code>TypeDict</code> ，一个带有键专属类型的字典类型，TypedDict 只使用字符串作为键。 默认情况下每个键都要求提供。 指定 “total=False” 以允许键作为可选项</p>
<h2 id="asyncio-run"><a href="#asyncio-run" class="headerlink" title="asyncio.run"></a>asyncio.run</h2><p><code>asyncio.run()</code> 已经从暂定状态晋级为稳定 API。 此函数可被用于执行一个 coroutine 并返回结果，同时自动管理事件循环。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">42</span></span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

<h2 id="其他特性"><a href="#其他特性" class="headerlink" title="其他特性"></a>其他特性</h2><ul>
<li>之前版本中 continue 语句不允许在 finally 子句中使用，这是因为具体实现存在一个问题。 在 Python3.8 中此限制已被取消</li>
<li>很多内置方法的性能都提高了 20% - 50%</li>
<li>typing.TypeDict</li>
</ul>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.stolenzc.com/2022/python_3_7_feature/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="stolen">
      <meta itemprop="description" content="一个热爱技术的Python开发者">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stolen's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/python_3_7_feature/" class="post-title-link" itemprop="url">Python3.7 新特性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-18 14:04:23" itemprop="dateCreated datePublished" datetime="2022-09-18T14:04:23+08:00">2022-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-23 09:29:00" itemprop="dateModified" datetime="2022-11-23T09:29:00+08:00">2022-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Python3.7 发布于2018年6月27日，这儿总结一下改版本引入的一些新功能</p>
<p>官方新特性链接 <a href="https://docs.python.org/zh-cn/3.7/whatsnew/3.7.html" target="_blank" rel="noopener">Python3.7 新特性</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>此处主要介绍在Ubuntu下安装 Python3.7</p>
<ol>
<li>添加deadsnakes源<ul>
<li><code>sudo add-apt-repository ppa:deadsnakes/ppa</code></li>
<li><code>sudo apt-get update</code></li>
</ul>
</li>
<li>安装 Python3.7<ul>
<li><code>sudo apt install python3.7-full</code></li>
</ul>
</li>
<li>安装 Python3.7 的pip<ul>
<li><code>python3.7 -m ensurepip --upgrade</code></li>
</ul>
</li>
</ol>
<h2 id="breakpoint-函数"><a href="#breakpoint-函数" class="headerlink" title="breakpoint 函数"></a>breakpoint 函数</h2><p>内置了新的 <code>breakpoint()</code> 函数，作为简单进入Python调试的方式，使用 <code>breakpoint()</code> 函数，相当于设置了断点，遇到 <code>breakpoint()</code> 会自动进入 pdb 调试模式</p>
<p>内置 breakpoint() 会调用 sys.breakpointhook()。 在默认情况下后者会导入 pdb 然后再调用 pdb.set_trace()，但是通过将 sys.breakpointhook() 绑定到你选定的函数，breakpoint() 可以进入任何调试器。 此外，环境变量 PYTHONBREAKPOINT 可被设置为你选定的调试器的可调用对象。 设置 PYTHONBREAKPOINT=0 会完全禁用内置 breakpoint()。</p>
<h2 id="具有纳秒级精度的新时间函数"><a href="#具有纳秒级精度的新时间函数" class="headerlink" title="具有纳秒级精度的新时间函数"></a>具有纳秒级精度的新时间函数</h2><p>现代系统的时钟精度可以超过由 time.time() 函数及其变化形式所返回的浮点数的有限精度。 为了避免精度损失，Python3.7 在 time 模块中增加了原有计时器函数的六个新“纳秒版”变化形式</p>
<ul>
<li>time.clock_gettime_ns()</li>
<li>time.clock_settime_ns()</li>
<li>time.monotonic_ns()</li>
<li>time.perf_counter_ns()</li>
<li>time.process_time_ns()</li>
<li>time.time_ns()</li>
</ul>
<p>这些新函数会以整数值的形式返回纳秒数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">print(time.time())</span><br><span class="line">print(time.time_ns())</span><br><span class="line"><span class="comment"># 1663496284.7790382</span></span><br><span class="line"><span class="comment"># 1663496284779068663</span></span><br></pre></td></tr></table></figure>

<h2 id="新增-dataclasses"><a href="#新增-dataclasses" class="headerlink" title="新增 dataclasses"></a>新增 dataclasses</h2><p>新的 dataclass() 装饰器提供了一种声明数据类的方式。 数据类使用变量标注来描述其属性。 它的构造器和其他魔术方法例如 <strong>repr</strong>(), <strong>eq</strong>() 以及 <strong>hash</strong>() 会自动地生成。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>:</span></span><br><span class="line">    x: float</span><br><span class="line">    y: float</span><br><span class="line">    z: float = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">同一下代码</span></span><br><span class="line"><span class="string">class Point:</span></span><br><span class="line"><span class="string">    def __init__(self, x: float, y: float, z: float=0.0):</span></span><br><span class="line"><span class="string">        self.x = x</span></span><br><span class="line"><span class="string">        self.y = y</span></span><br><span class="line"><span class="string">        self.z = z</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">p = Point(<span class="number">1.5</span>, <span class="number">2.5</span>)</span><br><span class="line">print(p)   <span class="comment"># produces "Point(x=1.5, y=2.5, z=0.0)"</span></span><br></pre></td></tr></table></figure>

<h2 id="dict-对象正式保持插入时顺序"><a href="#dict-对象正式保持插入时顺序" class="headerlink" title="dict 对象正式保持插入时顺序"></a>dict 对象正式保持插入时顺序</h2><p>dict 对象会保持插入时的顺序这个特性其实在 Python 3.6 中已经非正式的出场了，现在 Python 3.7 中正式宣布成为 Python 语言官方规范的一部分。</p>
<p>dict 对象有了顺序，对于一些方法自然就有了影响，比如 popitem 之前是随机删除，而现在 就是删除最后加入的键值对了，有了确定性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=&#123;<span class="string">'a'</span>: <span class="number">1</span>,<span class="string">'b'</span>: <span class="number">2</span>,<span class="string">'c'</span>: <span class="number">3</span>&#125;</span><br><span class="line">print(a.popitem())</span><br><span class="line"><span class="comment"># ('c', 3)</span></span><br><span class="line">print(a)</span><br><span class="line"><span class="comment"># &#123;'a': 1, 'b': 2&#125;</span></span><br></pre></td></tr></table></figure>

<p>但是，按照 dict 的特性，我们在写代码的过程中依然不应该依赖 dict 有序，实际开发中还是应该按照无序处理</p>
<h2 id="新增-getattr-定制对模块属性的访问"><a href="#新增-getattr-定制对模块属性的访问" class="headerlink" title="新增 getattr() 定制对模块属性的访问"></a>新增 <strong>getattr</strong>() 定制对模块属性的访问</h2><p>Python 3.7 允许在模块上定义 <code>__getattr__()</code> 并且当以其他方式找不到某个模块属性时将会调用它。 在模块上定义 <code>__dir__()</code> 现在也是允许的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(object)</span>:</span></span><br><span class="line">    name: str</span><br><span class="line">    age: int</span><br><span class="line">    sex: int = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Can't find <span class="subst">&#123;item&#125;</span> attribute"</span></span><br><span class="line"></span><br><span class="line">user = User(<span class="string">'stolen'</span>, <span class="number">18</span>, <span class="number">2</span>)</span><br><span class="line">print(user.name)</span><br><span class="line">print(user.age)</span><br><span class="line">print(user.sex)</span><br><span class="line">print(user.info)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">stolen</span></span><br><span class="line"><span class="string">18</span></span><br><span class="line"><span class="string">2</span></span><br><span class="line"><span class="string">Can't find info attribute</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li>async 和 await 变为了保留关键字</li>
<li>typing 不会向核心 CPython 解释器引入的限制取消了</li>
<li>允许将超过 255 个参数传递给一个函数，而现在一个函数也可以拥有超过 255 个形参</li>
</ul>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.stolenzc.com/2022/python_3_6_feature/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="stolen">
      <meta itemprop="description" content="一个热爱技术的Python开发者">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stolen's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/python_3_6_feature/" class="post-title-link" itemprop="url">Python3.6 新特性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-18 08:48:39" itemprop="dateCreated datePublished" datetime="2022-09-18T08:48:39+08:00">2022-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-23 09:29:00" itemprop="dateModified" datetime="2022-11-23T09:29:00+08:00">2022-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Python3.6 发布于2016年12月23日，这儿总结一下改版本引入的一些新功能</p>
<p>官方新特性链接 <a href="https://docs.python.org/zh-cn/3.6/whatsnew/3.6.html" target="_blank" rel="noopener">Python3.6 新特性</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>此处主要介绍在Ubuntu下安装 Python3.6</p>
<ol>
<li>添加deadsnakes源<ul>
<li><code>sudo add-apt-repository ppa:deadsnakes/ppa</code></li>
<li><code>sudo apt-get update</code></li>
</ul>
</li>
<li>安装 Python3.6<ul>
<li><code>sudo apt install python3.6-full</code></li>
</ul>
</li>
<li>安装 Python3.6 的pip<ul>
<li><code>python3.6 -m ensurepip --upgrade</code></li>
</ul>
</li>
</ol>
<h2 id="f-string"><a href="#f-string" class="headerlink" title="f-string"></a>f-string</h2><p>Python3.6 引入了一种 <code>f-string</code> 的方式来格式化字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">"Fred"</span></span><br><span class="line"><span class="string">f"He said his name is <span class="subst">&#123;name&#125;</span>."</span></span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># He said his name is Fred.</span></span><br><span class="line"></span><br><span class="line">width = <span class="number">10</span></span><br><span class="line">precision = <span class="number">4</span></span><br><span class="line">value = <span class="number">12.34567</span></span><br><span class="line"><span class="string">f"result: <span class="subst">&#123;value:&#123;width&#125;</span>.<span class="subst">&#123;precision&#125;</span>&#125;"</span></span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># result:      12.35</span></span><br><span class="line"><span class="comment"># 备注：小数点也占10位中的一个字符宽度</span></span><br></pre></td></tr></table></figure>

<h2 id="变量注释的语法"><a href="#变量注释的语法" class="headerlink" title="变量注释的语法"></a>变量注释的语法</h2><p>在 Python3.5 中，引入了类型标注 <code>Type Hint</code> ，在 Python3.6 中又加入了函数参数的标注，包括实参和行参的标注</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List,Dict</span><br><span class="line"></span><br><span class="line">primes: List[int] = []</span><br><span class="line"></span><br><span class="line">captain: str  <span class="comment"># 仅做类型标注，不初始化值</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Starship</span>:</span></span><br><span class="line">    stats: Dict[str, int] = &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数字文字中的下划线"><a href="#数字文字中的下划线" class="headerlink" title="数字文字中的下划线"></a>数字文字中的下划线</h2><p>Python3.6 中在数字值之间使用下划线改善可读性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="number">1</span>_000_000_000_000_000</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：</p>
<ul>
<li>单个下划线允许用在数码之间和任何数制指示符之后</li>
<li>不可以两个下划线连在一起</li>
<li>字符串格式化可以用 <code>_</code> 或 <code>_d</code> 来用下划线表示千分位分隔符<ul>
<li><code>f&#39;{100000000:_}&#39;</code> 输出: <code>100_000_000</code></li>
<li><code>f&#39;{100000000:_d}&#39;</code> 输出: <code>100_000_000</code></li>
</ul>
</li>
<li><code>_b</code> 、 <code>_o</code> 、 <code>_x</code> 可以让数字以二进制、八进制、十进制、十六进制每隔4个数码分割<ul>
<li><code>f&#39;{100000000:_x}&#39;</code> 输出: <code>5f5_e100</code></li>
<li><code>f&#39;{128:_b}&#39;</code> 输出: <code>1000_0000</code></li>
</ul>
</li>
</ul>
<h2 id="secrets-生成安全随机数字"><a href="#secrets-生成安全随机数字" class="headerlink" title="secrets 生成安全随机数字"></a>secrets 生成安全随机数字</h2><p>Python3.6 中新增的 <code>secrets</code> 模块的主要目的是提供一种简单的方法来可靠地生成适用于管理秘密的加密强伪随机值，例如帐户身份验证、令牌等。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line">secrets.token_bytes(<span class="number">16</span>)</span><br><span class="line"><span class="comment"># b'\x12Z\xebb\xa0\xab\xca\xc3W\xbe\xfdCFr\x86\xcd'</span></span><br><span class="line"></span><br><span class="line">secrets.token_hex(<span class="number">16</span>)</span><br><span class="line"><span class="comment"># a890afe1433b3044e1316fd7aa23787f</span></span><br></pre></td></tr></table></figure>

<p>在 Python3.6 以下的版本则推荐使用 <code>os.urandom()</code></p>
<h2 id="异步生成器"><a href="#异步生成器" class="headerlink" title="异步生成器"></a>异步生成器</h2><p>在 Python3.5 中引入了 <code>async</code> 和 <code>await</code> ，但是在 Python3.5 中无法在一个函数中同时使用 <code>await</code> 和 <code>yield</code> ，在 Python3.6 解决了这个问题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">ticker</span><span class="params">(delay, to)</span>:</span></span><br><span class="line">    <span class="string">"""Yield numbers from 0 to *to* every *delay* seconds."""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(to):</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(delay)</span><br></pre></td></tr></table></figure>

<h2 id="异步推导"><a href="#异步推导" class="headerlink" title="异步推导"></a>异步推导</h2><p>添加了对在列表、集合与字典推导式和生成器表达式中使用 async for 的支持</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = [i <span class="keyword">async</span> <span class="keyword">for</span> i <span class="keyword">in</span> aiter() <span class="keyword">if</span> i % <span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<p><code>await</code> 表达式也在所有种类的推导式中得到支持</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = [<span class="keyword">await</span> fun() <span class="keyword">for</span> fun <span class="keyword">in</span> funcs <span class="keyword">if</span> <span class="keyword">await</span> condition()]</span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li>将 Windows 文件系统编码和控制台编码都更改为 UTF-8</li>
<li>重新实现了字典 dict，使其内存使用减少了 20%-25%</li>
</ul>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.stolenzc.com/2022/hugo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="stolen">
      <meta itemprop="description" content="一个热爱技术的Python开发者">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stolen's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/hugo/" class="post-title-link" itemprop="url">Hugo博客搭建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-14 08:28:59" itemprop="dateCreated datePublished" datetime="2022-09-14T08:28:59+08:00">2022-09-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%BB%BA%E7%AB%99/" itemprop="url" rel="index"><span itemprop="name">建站</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>16 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>很久之前就想要将之前hexo的博客迁移到hugo上，主要原因一个是hexo的next主题使用了两年多了，两年来审美发生了很大变化，在偶然间发现了hugo的paper主题，感觉很好看，于是就想着迁移过去。还有一个原因是自己也想要体验一下hugo的搭建过程，看看hugo的优势在哪里。还有一个原因就是自己的hexo主题自己不太能够控制了，很多地方的配置因为当时特殊修改过导致现在已经不太敢去动了，来必力评论突然出现了大量的广告。实在是不能忍受。</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>使用了PaperMod主题，大部分配置都是参考<a href="https://gohugo.io/documentation/" target="_blank" rel="noopener">hugo官方文档</a> 和 <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/Features" target="_blank" rel="noopener">PaperMod主题文档</a></p>
<p>做了几个特殊的配置</p>
<h3 id="引入fontaewsome图标"><a href="#引入fontaewsome图标" class="headerlink" title="引入fontaewsome图标"></a>引入fontaewsome图标</h3><p>复制主题目录中<code>layouts/partials/head.html</code> 文件到博客根目录 <code>layouts/partials/head.html</code>下，然后在<code>head.html</code>中引入以下代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://use.fontawesome.com/releases/v5.15.4/css/all.css"</span> <span class="attr">integrity</span>=<span class="string">"sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在配置的地方直接使用就可以了</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">    <span class="attr">main:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">identifier:</span> <span class="string">home</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">主页</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">/</span></span><br><span class="line">      <span class="attr">pre:</span> <span class="string">&lt;i</span> <span class="string">class='fa</span> <span class="string">fa-home'&gt;&lt;/i&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">identifier:</span> <span class="string">tags</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">标签</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">tags/</span></span><br><span class="line">      <span class="attr">pre:</span> <span class="string">&lt;i</span> <span class="string">class='fa</span> <span class="string">fa-tags'&gt;&lt;/i&gt;</span></span><br></pre></td></tr></table></figure>

<p>默认情况下图标和汉字会紧挨着，可以在i标签中添加一个空格来解决 <code>&lt;i class=&#39;fa fa-tags&#39;&gt;&amp;ensp;&lt;/i&gt;</code></p>
<h3 id="侧边栏目录"><a href="#侧边栏目录" class="headerlink" title="侧边栏目录"></a>侧边栏目录</h3><p>PaperMod主题默认的toc目录是在文章开头，作为目录始终感觉不太方便，这里参考 <a href="https://www.sulvblog.cn/posts/blog/hugo_toc_side/" target="_blank" rel="noopener">Hugo博客目录放在侧边 | PaperMod主题</a> 中的方法将其修改为左边栏</p>
<p>主要是修改toc.html文件</p>
<p>创建文件 <code>layouts/partials/toc.html</code>，然后将<code>toc.html</code>中加入以下代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;- $headers := findRE "<span class="tag">&lt;<span class="name">h[1-6].*?</span>&gt;</span>(.|\n])+?<span class="tag">&lt;/<span class="name">h[1-6]</span>&gt;</span>" .Content -&#125;&#125;</span><br><span class="line">&#123;&#123;- $has_headers := ge (len $headers) 1 -&#125;&#125;</span><br><span class="line">&#123;&#123;- if $has_headers -&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">aside</span> <span class="attr">id</span>=<span class="string">"toc-container"</span> <span class="attr">class</span>=<span class="string">"toc-container wide"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toc"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">details</span> &#123;&#123;<span class="attr">if</span> (<span class="attr">.Param</span> "<span class="attr">TocOpen</span>") &#125;&#125; <span class="attr">open</span>&#123;&#123; <span class="attr">end</span> &#125;&#125;&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">summary</span> <span class="attr">accesskey</span>=<span class="string">"c"</span> <span class="attr">title</span>=<span class="string">"(Alt + C)"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"details"</span>&gt;</span>&#123;&#123;- i18n "toc" | default "Table of Contents" &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">summary</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span></span><br><span class="line">                &#123;&#123;- $largest := 6 -&#125;&#125;</span><br><span class="line">                &#123;&#123;- range $headers -&#125;&#125;</span><br><span class="line">                &#123;&#123;- $headerLevel := index (findRE "[1-6]" . 1) 0 -&#125;&#125;</span><br><span class="line">                &#123;&#123;- $headerLevel := len (seq $headerLevel) -&#125;&#125;</span><br><span class="line">                &#123;&#123;- if lt $headerLevel $largest -&#125;&#125;</span><br><span class="line">                &#123;&#123;- $largest = $headerLevel -&#125;&#125;</span><br><span class="line">                &#123;&#123;- end -&#125;&#125;</span><br><span class="line">                &#123;&#123;- end -&#125;&#125;</span><br><span class="line"></span><br><span class="line">                &#123;&#123;- $firstHeaderLevel := len (seq (index (findRE "[1-6]" (index $headers 0) 1) 0)) -&#125;&#125;</span><br><span class="line"></span><br><span class="line">                &#123;&#123;- $.Scratch.Set "bareul" slice -&#125;&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                    &#123;&#123;- range seq (sub $firstHeaderLevel $largest) -&#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                        &#123;&#123;- $.Scratch.Add "bareul" (sub (add $largest .) 1) -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- end -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- range $i, $header := $headers -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- $headerLevel := index (findRE "[1-6]" . 1) 0 -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- $headerLevel := len (seq $headerLevel) -&#125;&#125;</span><br><span class="line"></span><br><span class="line">                        &#123;&#123;/* get id="xyz" */&#125;&#125;</span><br><span class="line">                        &#123;&#123;- $id := index (findRE "(id=\"(.*?)\")" $header 9) 0 &#125;&#125;</span><br><span class="line"></span><br><span class="line">                        &#123;&#123;- /* strip id="" to leave xyz, no way to get regex capturing groups in hugo */ -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- $cleanedID := replace (replace $id "id=\"" "") "\"" "" &#125;&#125;</span><br><span class="line">                        &#123;&#123;- $header := replaceRE "<span class="tag">&lt;<span class="name">h[1-6].*?</span>&gt;</span>((.|\n])+?)<span class="tag">&lt;/<span class="name">h[1-6]</span>&gt;</span>" "$1" $header -&#125;&#125;</span><br><span class="line"></span><br><span class="line">                        &#123;&#123;- if ne $i 0 -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- $prevHeaderLevel := index (findRE "[1-6]" (index $headers (sub $i 1)) 1) 0 -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- $prevHeaderLevel := len (seq $prevHeaderLevel) -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- if gt $headerLevel $prevHeaderLevel -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- range seq $prevHeaderLevel (sub $headerLevel 1) -&#125;&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                            &#123;&#123;/* the first should not be recorded */&#125;&#125;</span><br><span class="line">                            &#123;&#123;- if ne $prevHeaderLevel . -&#125;&#125;</span><br><span class="line">                            &#123;&#123;- $.Scratch.Add "bareul" . -&#125;&#125;</span><br><span class="line">                            &#123;&#123;- end -&#125;&#125;</span><br><span class="line">                            &#123;&#123;- end -&#125;&#125;</span><br><span class="line">                            &#123;&#123;- else -&#125;&#125;</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                            &#123;&#123;- if lt $headerLevel $prevHeaderLevel -&#125;&#125;</span><br><span class="line">                            &#123;&#123;- range seq (sub $prevHeaderLevel 1) -1 $headerLevel -&#125;&#125;</span><br><span class="line">                            &#123;&#123;- if in ($.Scratch.Get "bareul") . -&#125;&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                        &#123;&#123;/* manually do pop item */&#125;&#125;</span><br><span class="line">                        &#123;&#123;- $tmp := $.Scratch.Get "bareul" -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- $.Scratch.Delete "bareul" -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- $.Scratch.Set "bareul" slice&#125;&#125;</span><br><span class="line">                        &#123;&#123;- range seq (sub (len $tmp) 1) -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- $.Scratch.Add "bareul" (index $tmp (sub . 1)) -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- end -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- else -&#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    &#123;&#123;- end -&#125;&#125;</span><br><span class="line">                    &#123;&#123;- end -&#125;&#125;</span><br><span class="line">                    &#123;&#123;- end -&#125;&#125;</span><br><span class="line">                    &#123;&#123;- end &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#&#123;&#123;- $cleanedID -&#125;&#125;"</span> <span class="attr">aria-label</span>=<span class="string">"&#123;&#123;- $header | plainify -&#125;&#125;"</span>&gt;</span>&#123;&#123;- $header | safeHTML -&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        &#123;&#123;- else &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#&#123;&#123;- $cleanedID -&#125;&#125;"</span> <span class="attr">aria-label</span>=<span class="string">"&#123;&#123;- $header | plainify -&#125;&#125;"</span>&gt;</span>&#123;&#123;- $header | safeHTML -&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        &#123;&#123;- end -&#125;&#125;</span><br><span class="line">                        &#123;&#123;- end -&#125;&#125;</span><br><span class="line">                        <span class="comment">&lt;!-- &#123;&#123;- $firstHeaderLevel := len (seq (index (findRE "[1-6]" (index $headers 0) 1) 0)) -&#125;&#125; --&gt;</span></span><br><span class="line">                        &#123;&#123;- $firstHeaderLevel := $largest &#125;&#125;</span><br><span class="line">                        &#123;&#123;- $lastHeaderLevel := len (seq (index (findRE "[1-6]" (index $headers (sub (len $headers) 1)) 1) 0)) &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    &#123;&#123;- range seq (sub $lastHeaderLevel $firstHeaderLevel) -&#125;&#125;</span><br><span class="line">                    &#123;&#123;- if in ($.Scratch.Get "bareul") (add . $firstHeaderLevel) &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                &#123;&#123;- else &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                &#123;&#123;- end -&#125;&#125;</span><br><span class="line">                &#123;&#123;- end &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">details</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> activeElement;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> elements;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line">        checkTocPosition();</span><br><span class="line"></span><br><span class="line"><span class="javascript">        elements = <span class="built_in">document</span>.querySelectorAll(<span class="string">'h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]'</span>);</span></span><br><span class="line"><span class="actionscript">         <span class="comment">// Make the first header active</span></span></span><br><span class="line">         activeElement = elements[0];</span><br><span class="line"><span class="javascript">         <span class="keyword">const</span> id = <span class="built_in">encodeURI</span>(activeElement.getAttribute(<span class="string">'id'</span>)).toLowerCase();</span></span><br><span class="line"><span class="javascript">         <span class="built_in">document</span>.querySelector(<span class="string">`.inner ul li a[href="#<span class="subst">$&#123;id&#125;</span>"]`</span>).classList.add(<span class="string">'active'</span>);</span></span><br><span class="line"><span class="actionscript">     &#125;, <span class="literal">false</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line">        checkTocPosition();</span><br><span class="line"><span class="actionscript">    &#125;, <span class="literal">false</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">'scroll'</span>, () =&gt; &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// Check if there is an object in the top half of the screen or keep the last item active</span></span></span><br><span class="line"><span class="javascript">        activeElement = <span class="built_in">Array</span>.from(elements).find(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> ((getOffsetTop(element) - <span class="built_in">window</span>.pageYOffset) &gt; <span class="number">0</span> &amp;&amp; </span></span><br><span class="line"><span class="javascript">                (getOffsetTop(element) - <span class="built_in">window</span>.pageYOffset) &lt; <span class="built_in">window</span>.innerHeight/<span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> element;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;) || activeElement</span><br><span class="line"></span><br><span class="line"><span class="javascript">        elements.forEach(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">             <span class="keyword">const</span> id = <span class="built_in">encodeURI</span>(element.getAttribute(<span class="string">'id'</span>)).toLowerCase();</span></span><br><span class="line">             if (element === activeElement)&#123;</span><br><span class="line"><span class="javascript">                 <span class="built_in">document</span>.querySelector(<span class="string">`.inner ul li a[href="#<span class="subst">$&#123;id&#125;</span>"]`</span>).classList.add(<span class="string">'active'</span>);</span></span><br><span class="line"><span class="actionscript">             &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                 <span class="built_in">document</span>.querySelector(<span class="string">`.inner ul li a[href="#<span class="subst">$&#123;id&#125;</span>"]`</span>).classList.remove(<span class="string">'active'</span>);</span></span><br><span class="line">             &#125;</span><br><span class="line">         &#125;)</span><br><span class="line"><span class="actionscript">     &#125;, <span class="literal">false</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> main = <span class="built_in">parseInt</span>(getComputedStyle(<span class="built_in">document</span>.body).getPropertyValue(<span class="string">'--article-width'</span>), <span class="number">10</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> toc = <span class="built_in">parseInt</span>(getComputedStyle(<span class="built_in">document</span>.body).getPropertyValue(<span class="string">'--toc-width'</span>), <span class="number">10</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> gap = <span class="built_in">parseInt</span>(getComputedStyle(<span class="built_in">document</span>.body).getPropertyValue(<span class="string">'--gap'</span>), <span class="number">10</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">checkTocPosition</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> width = <span class="built_in">document</span>.body.scrollWidth;</span></span><br><span class="line"></span><br><span class="line">        if (width - main - (toc * 2) - (gap * 4) &gt; 0) &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">"toc-container"</span>).classList.add(<span class="string">"wide"</span>);</span></span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">"toc-container"</span>).classList.remove(<span class="string">"wide"</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">getOffsetTop</span><span class="params">(element)</span> </span>&#123;</span></span><br><span class="line">        if (!element.getClientRects().length) &#123;</span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> <span class="number">0</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> rect = element.getBoundingClientRect();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> win = element.ownerDocument.defaultView;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> rect.top + win.pageYOffset;   </span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;&#123;- end &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>新建文件 <code>assets/css/extended/blank.css</code>，内容如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="attribute">--nav-width</span>: <span class="number">1380px</span>;</span><br><span class="line">    <span class="attribute">--article-width</span>: <span class="number">650px</span>;</span><br><span class="line">    <span class="attribute">--toc-width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">40px</span> <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--border);</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--entry);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--radius);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.4em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc-container</span><span class="selector-class">.wide</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--border);</span><br><span class="line">    <span class="attribute">left</span>: <span class="built_in">calc</span>((var(--toc-width) + <span class="built_in">var</span>(--gap)) * -<span class="number">1</span>);</span><br><span class="line">    <span class="attribute">top</span>: <span class="built_in">calc</span>(var(--gap) * <span class="number">2</span>);</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">var</span>(--toc-width);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.wide</span> <span class="selector-class">.toc</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: sticky;</span><br><span class="line">    <span class="attribute">top</span>: <span class="built_in">var</span>(--gap);</span><br><span class="line">    <span class="attribute">border</span>: unset;</span><br><span class="line">    <span class="attribute">background</span>: unset;</span><br><span class="line">    <span class="attribute">border-radius</span>: unset;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">40px</span> <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc</span> <span class="selector-tag">details</span> <span class="selector-tag">summary</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: zoom-in;</span><br><span class="line">    <span class="attribute">margin-inline-start</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">12px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc</span> <span class="selector-tag">details</span><span class="selector-attr">[open]</span> <span class="selector-tag">summary</span> &#123;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc-container</span><span class="selector-class">.wide</span> <span class="selector-class">.toc</span> <span class="selector-class">.inner</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.active</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">110%</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc</span> <span class="selector-tag">ul</span> &#123;</span><br><span class="line">    <span class="attribute">list-style-type</span>: circle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc</span> <span class="selector-class">.inner</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0px</span> <span class="number">15px</span> <span class="number">15px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*目录显示高度*/</span></span><br><span class="line">    <span class="attribute">max-height</span>: <span class="number">83vh</span>;</span><br><span class="line">    <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc</span> <span class="selector-class">.inner</span><span class="selector-pseudo">::-webkit-scrollbar-thumb</span> &#123;  <span class="comment">/*滚动条*/</span></span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--border);</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">7px</span> solid <span class="built_in">var</span>(--theme);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--radius);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc</span> <span class="selector-tag">li</span> <span class="selector-tag">ul</span> &#123;</span><br><span class="line">    <span class="attribute">margin-inline-start</span>: <span class="built_in">calc</span>(var(--gap) * <span class="number">0.5</span>);</span><br><span class="line">    <span class="attribute">list-style-type</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0.95rem</span>;</span><br><span class="line">    <span class="attribute">padding-bottom</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--secondary);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="不足"><a href="#不足" class="headerlink" title="不足"></a>不足</h2><p>虽然hugo一切都很好，但有一个很难受的问题，在hexo中，可以通过<code>hexo-blog-encrypt</code>插件来对文章进行加密，但是在hugo中不支持插件，找到了一个可以加密的工具<code>hugo-encryptor</code>，但是只支持对文字部分内容加密，还没有更好的方法对文字全文进行加密。我会不断探索，如果读者有更好的建议也可以<a href="mailto:stolenzc@88.com">联系我</a>。</p>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.stolenzc.com/2022/oauth2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="stolen">
      <meta itemprop="description" content="一个热爱技术的Python开发者">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stolen's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/oauth2/" class="post-title-link" itemprop="url">OAuth2.0认证</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-27 22:29:57" itemprop="dateCreated datePublished" datetime="2022-05-27T22:29:57+08:00">2022-05-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="OAuth介绍"><a href="#OAuth介绍" class="headerlink" title="OAuth介绍"></a>OAuth介绍</h2><p><a href="https://datatracker.ietf.org/doc/html/rfc6749" target="_blank" rel="noopener">OAuth2.0官方文档</a></p>
<ul>
<li>Open Standard Authorization (OAuth)</li>
<li>OAuth是一个网络开放协议。为保证用户资源的安全授权提供了简易的标准</li>
</ul>
<p>特点：</p>
<ul>
<li>简单：不管是OAUTH服务提供者还是应用开发者，都很易于理解与使用</li>
<li>安全：没有涉及到用户密钥等信息，更安全更灵活</li>
<li>开放：任何服务提供商都可以实现OAUTH，任何软件开发商都可以使用OAuth</li>
</ul>
<h2 id="OAuth2-0"><a href="#OAuth2-0" class="headerlink" title="OAuth2.0"></a>OAuth2.0</h2><ul>
<li>2012年10月，OAuth 2.0协议正式发布为RFC 6749</li>
<li>OAuth协议的下一版本，但不向后兼容OAuth 1.0</li>
<li>OAuth 2.0关注客户端开发者的简易性，同时为Web应用，桌面应用和手机，和起居室设备提供专门的认证流程</li>
</ul>
<h2 id="OAuth2-0角色"><a href="#OAuth2-0角色" class="headerlink" title="OAuth2.0角色"></a>OAuth2.0角色</h2><p>resource owner: 资源所有者，指的是用户</p>
<p>resource server: 资源服务器，指的是应用服务器</p>
<p>client: 客户端，指的是应用</p>
<p>authorization server: 授权服务器，指的是应用服务器</p>
<h2 id="OAuth2-0流程"><a href="#OAuth2-0流程" class="headerlink" title="OAuth2.0流程"></a>OAuth2.0流程</h2><pre><code>+--------+                               +---------------+
|        |--(A)- Authorization Request -&gt;|   Resource    |
|        |                               |     Owner     |
|        |&lt;-(B)-- Authorization Grant ---|               |
|        |                               +---------------+
|        |
|        |                               +---------------+
|        |--(C)-- Authorization Grant --&gt;| Authorization |
| Client |                               |     Server    |
|        |&lt;-(D)----- Access Token -------|               |
|        |                               +---------------+
|        |
|        |                               +---------------+
|        |--(E)----- Access Token ------&gt;|    Resource   |
|        |                               |     Server    |
|        |&lt;-(F)--- Protected Resource ---|               |
+--------+                               +---------------+</code></pre><p>A: 客户端向资源所有者请求授权。这授权请求可以直接向资源所有者提出，或者最好通过授权间接服务器作为中介</p>
<p>B: 客户端收到授权授权，这是一个代表资源所有者授权的凭证</p>
<p>C: 客户端通过身份验证请求访问令牌 授权服务器并提供授权许可</p>
<p>D: 授权服务器对客户端进行身份验证并验证授权，如果有效，则颁发访问令牌</p>
<p>E: 客户端向资源请求受保护的资源 服务器并通过提供访问令牌进行身份验证</p>
<p>F: 资源服务器验证访问令牌，如果有效，则提供资源</p>
<h2 id="OAuth2-0授权类型"><a href="#OAuth2-0授权类型" class="headerlink" title="OAuth2.0授权类型"></a>OAuth2.0授权类型</h2><ul>
<li>授权码（Authorization Code）</li>
<li>隐藏式（implicit）</li>
<li>密码式（password）</li>
<li>客户端凭证（client credentials）</li>
</ul>
<h3 id="授权码授权类型（Authorization-Code）"><a href="#授权码授权类型（Authorization-Code）" class="headerlink" title="授权码授权类型（Authorization Code）"></a>授权码授权类型（Authorization Code）</h3><p>第三方应用先申请一个授权码，再通过授权码获取访问令牌。适合有后端的应用，比如网站应用。</p>
<p>scope参数</p>
<p>步骤：</p>
<ol>
<li>A网站提供一个链接，链接中包含本网站的跳转地址、网站的身份（client_id或app_key），点击后跳转到B网站</li>
<li>B网站进行登陆，登陆成功后，跳转到A网站，并且在URL中携带一个授权码</li>
<li>A网站拿到授权码，在后端携带授权码来请求A网站的接口（携带授权码、appkey、secretkey）</li>
<li>B站收到请求，验证授权码，如果验证成功，则返回访问令牌，重刷令牌（access_token, refresh_token）</li>
</ol>
<p>通常请求格式为: <code>https://stolenzc.com/oauth/authorize?response_type=code&amp;appkey=appkey&amp;redirect_uri=redirect_uri&amp;scope=scope</code></p>
<ul>
<li>response_type: 授权类型，必须为code</li>
<li>appkey: 网站的身份，为应用在网站申请的appkey</li>
<li>redirect_uri: 申请成功后网站的回跳地址</li>
<li>scope: 网站的范围，可以为空，为空则表示全部范围，可以为多个范围，用逗号分隔</li>
</ul>
<p>响应格式: 在回跳地址中携带授权码，比如：<code>https://stolenzc.com/callback?code=1234567890</code></p>
<p>后台再请求令牌的格式: <code>https://stolenzc.com/oauth/token?appkey=appkey&amp;appsecret=appsecret&amp;grant_type=authorization_code&amp;code=code&amp;redirect_uri=redirect_uri</code></p>
<ul>
<li>grant_type: 授权类型，必须为authorization_code</li>
<li>appkey: 网站的身份，为应用在网站申请的appkey</li>
<li>appsecret: 网站的身份，为应用在网站申请的appsecret,appsecret为保密的，所以只能在后端请求</li>
<li>code: 授权码</li>
<li>redirect_uri: 验证成功后授权方带上token数据请求该uri地址传递token数据</li>
</ul>
<h3 id="隐藏式授权类型（implicit）"><a href="#隐藏式授权类型（implicit）" class="headerlink" title="隐藏式授权类型（implicit）"></a>隐藏式授权类型（implicit）</h3><p>第三方应用请求接口直接获取访问令牌。适合没有后端的应用，比如移动应用。</p>
<p>步骤：</p>
<ol>
<li>A网站提供一个链接，链接中包含本网站的跳转地址、网站的身份（client_id或app_key），点击后跳转到B网站</li>
<li>B网站进行登陆，登陆成功后，跳转到A网站，并且在URL中以锚点的形式携带一个访问令牌</li>
</ol>
<p>通常请求格式为: <code>https://stolenzc.com/oauth/authorize?response_type=token&amp;appkey=appkey&amp;redirect_uri=redirect_uri&amp;scope=scope</code></p>
<ul>
<li>response_type: 授权类型，必须为token</li>
<li>appkey: 网站的身份，为应用在网站申请的appkey</li>
<li>redirect_uri: 申请成功后网站的回跳地址</li>
<li>scope: 网站的范围，可以为空，为空则表示全部范围，可以为多个范围，用逗号分隔</li>
</ul>
<h3 id="密码式授权类型（password）"><a href="#密码式授权类型（password）" class="headerlink" title="密码式授权类型（password）"></a>密码式授权类型（password）</h3><p>第三方应用拿到用户账号密码，直接用账号密码获取令牌</p>
<ol>
<li>A网站要求用户提供账号和密码，拿到后A网站直接向B网站请求令牌</li>
<li>B网站验证密码后，直接返回令牌，不需要进行跳转</li>
</ol>
<p>请求令牌的格式: <code>https://stolenzc.com/oauth/token?appkey=appkey&amp;grant_type=password&amp;username=username&amp;password=password</code></p>
<ul>
<li>grant_type: 授权类型，必须为password</li>
<li>appkey: 网站的身份，为应用在网站申请的appkey</li>
<li>username: 用户名</li>
<li>password: 密码</li>
</ul>
<h3 id="凭证式授权类型（client-credentials）"><a href="#凭证式授权类型（client-credentials）" class="headerlink" title="凭证式授权类型（client credentials）"></a>凭证式授权类型（client credentials）</h3><p>凭证式适用于没有前端的命令行应用，通常是多个用户享用一个令牌，通常针对第三方应用，不是针对用户的。</p>
<ol>
<li>A应用在命令行向B应用发出接口请求，只需要携带appkey和secretkey即可</li>
<li>B应用验证通过后，直接返回令牌</li>
</ol>
<p>请求令牌的格式: <code>https://stolenzc.com/oauth/token?grant_type=client_credentials&amp;appkey=appkey&amp;secretkey=secretkey</code></p>
<ul>
<li>grant_type: 授权类型，必须为client_credentials</li>
<li>appkey: 网站的身份，为应用在网站申请的appkey</li>
<li>secretkey: 网站的身份，为应用在网站申请的appsecret</li>
</ul>
<h2 id="使用令牌和令牌过期"><a href="#使用令牌和令牌过期" class="headerlink" title="使用令牌和令牌过期"></a>使用令牌和令牌过期</h2><p>后续请求资源的时候，需要将令牌放在请求头中携带</p>
<p>通常在申请令牌的时候，会同时返回一个refresh_token，用来在token失效的时候，重新申请一个新的令牌。</p>
<p>重刷令牌的格式: <code>https://stolenzc.com/oauth/token?grant_type=refresh_token&amp;appkey=appkey&amp;secretkey=secretkey&amp;refresh_token=refresh_token</code></p>
<ul>
<li>grant_type: 授权类型，必须为refresh_token</li>
<li>appkey: 网站的身份，为应用在网站申请的appkey</li>
<li>secretkey: 网站的身份，为应用在网站申请的appsecret</li>
<li>refresh_token: 重刷令牌</li>
</ul>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.stolenzc.com/2022/https/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="stolen">
      <meta itemprop="description" content="一个热爱技术的Python开发者">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stolen's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/https/" class="post-title-link" itemprop="url">HTTPS加密原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-16 23:00:20" itemprop="dateCreated datePublished" datetime="2022-05-16T23:00:20+08:00">2022-05-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="HTTPS传输的加密使用"><a href="#HTTPS传输的加密使用" class="headerlink" title="HTTPS传输的加密使用"></a>HTTPS传输的加密使用</h2><p>https在进行内容传输的时候使用的是对称加密</p>
<p>https在进行证书验证阶段使用的是非对称加密</p>
<h2 id="HTTP与HTTPS的区别"><a href="#HTTP与HTTPS的区别" class="headerlink" title="HTTP与HTTPS的区别"></a>HTTP与HTTPS的区别</h2><ul>
<li>默认端口，HTTP是80，HTTPS是443</li>
<li>传输协议，http是超文本传输协议，属于明文传输；https是安全的超文本传输协议，是经过SSL加密后的传输协议</li>
<li>安全性，https使用了TLS/SSL，比http更安全</li>
<li>证书，https需要申请ca证书</li>
<li>HTTPS的加密是在传输层完成的，因为SSL是位于传输层的，TLS的前身是SSL。</li>
</ul>
<h2 id="HTTP的通信过程"><a href="#HTTP的通信过程" class="headerlink" title="HTTP的通信过程"></a>HTTP的通信过程</h2><p>作为标准的C/S模型，http协议总是由客户端发起，服务器进行响应。</p>
<ol>
<li>DNS解析，域名系统DNS将域名解析成IP地址</li>
<li>建立TCP连接，进行TCP的三次握手</li>
<li>浏览器发送请求</li>
<li>服务器响应浏览器，向浏览器发送数据</li>
<li>通信完成，TCP连接关闭</li>
</ol>
<h2 id="HTTPS的通信过程"><a href="#HTTPS的通信过程" class="headerlink" title="HTTPS的通信过程"></a>HTTPS的通信过程</h2><p>https主要在http的2和3之间，建立了一个加密的连接，这个连接使用了TLS/SSL协议，它是一个安全的传输协议，它的加密使用了对称加密，而不是非对称加密。</p>
<p>通信过程如下 ：</p>
<ol>
<li>DNS解析，域名系统DNS将域名解析成IP地址</li>
<li>客户端和服务器端通过TCP建立连接，并发送https请求。</li>
<li>客户端发起TLS握手，向服务端发送<code>ClientHello</code>消息，<ul>
<li>客户端支持的SSL/TLS版本</li>
<li>客户端支持的加密套件，比如RSA加密算法</li>
<li>会话session id，（如果有的值的话，服务器端会复用对应的握手信息，避免短时间内重复握手）</li>
<li>客户端随机数，用于生成随机密钥</li>
</ul>
</li>
<li>服务器收到<code>ClientHello</code>消息，向客户端发送<code>ServerHello</code>消息<ul>
<li>服务器所能支持的最高SSL/TLS版本</li>
<li>服务器选择的加密套件列表，比如RSA加密算法</li>
<li>服务器随机数，用于生成随机密钥</li>
<li>服务器的ca证书</li>
</ul>
</li>
<li>客户端收到<code>ServerHello</code>后，会对收到的证书进行验证。包括验证证书机构、有效期等，验证证书的合法性验证</li>
<li>验证成功后，Client生成随机数，用于密钥交换过程。客户端会从数字证书中取出服务器的公钥，然后使用它加密报文该随机数，发送到服务器</li>
<li>服务器使用私钥解密。获取客户端发送的随机数</li>
<li>客户端使用这三个随机数一起计算出对称加密密钥，同理服务端也可以计算出这个加密密钥。客户端和服务端都计算出加密密钥<code>master secret</code></li>
<li>客户端用<code>master secret</code>加密了一条握手完成的消息发送给服务器</li>
<li>服务器端也回发了一条用<code>master secret</code>加密的握手完成的消息</li>
<li>服务器将发送的内容用<code>master secret</code>加密，然后发送给客户端</li>
<li>客户端使用<code>master secret</code>解密收到的消息</li>
</ol>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.stolenzc.com/2021/python_datetime/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="stolen">
      <meta itemprop="description" content="一个热爱技术的Python开发者">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stolen's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/python_datetime/" class="post-title-link" itemprop="url">Python中时间操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-04-10 11:08:42 / 修改时间：22:55:31" itemprop="dateCreated datePublished" datetime="2021-04-10T11:08:42+08:00">2021-04-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>说明：以 classmethod 开头表示类方法，不以 classmethod 开头表示对象方法</p>
</blockquote>
<h2 id="datetime-timezone"><a href="#datetime-timezone" class="headerlink" title="datetime.timezone"></a>datetime.timezone</h2><p>class datetime.timezone(offset, name=None)</p>
<ul>
<li>offset需要指定一个timedelta对象，表示与UTC时间的差值，范围在 <code>-timedelta(hours=24)</code> 到 <code>timedelta(hours=24)</code> 之间，注意这两个值不能取</li>
</ul>
<p>timezone.utc</p>
<ul>
<li>返回一个timezone对象，表示获取utc时区，等同于 <code>datetime.timezone(deltatime(0))</code></li>
<li>这是一个类属性（准确说是一个变量），不能在后面加括号调用</li>
</ul>
<h2 id="datetime-datetime"><a href="#datetime-datetime" class="headerlink" title="datetime.datetime"></a>datetime.datetime</h2><p>class datetime.datetime(year, month, day, hour=0, minute=0, second=0, microsecond=0, tzinfo=None, *, fold=0)</p>
<ul>
<li>year、month、day 值是必须的，tzinfo可以为None，也可以为tzinfo的一个实例</li>
</ul>
<p>classmethod datetime.now(tz=None)</p>
<ul>
<li>获取当前时间，返回一个datetime对象，默认tzinfo为None，表示本地时区，可以手动指定时区</li>
</ul>
<p>classmethod datetime.today()</p>
<ul>
<li>获取本地当前时间，相当于now(tz=None)</li>
</ul>
<p>classmethod datetime.utcnow()</p>
<ul>
<li>获取utc时区的当前时间，tzinfo为None</li>
</ul>
<p>classmethod datetime.strptime(date_string, format)</p>
<ul>
<li>将字符串解析为datetime时间，format表示date_string的格式</li>
</ul>
<p>datetime.strftime(format)</p>
<ul>
<li>返回一个字符串，由format控制格式</li>
</ul>
<p>classmethod datetime.fromtimestamp(timestamp, tz=None)</p>
<ul>
<li>将时间戳转换为datetime格式，不指定tz则为本地时区时间。</li>
</ul>
<p>classmethod datetime.utcfromtimestamp(timestamp)</p>
<ul>
<li>将时间戳转换为datetime格式的utc时区时间</li>
</ul>
<p>datetime.timestamp()</p>
<ul>
<li>返回datetime对应的时间戳</li>
</ul>
<p>classmethod datetime.combine(date, time, tzinfo=self.tzinfo)</p>
<ul>
<li>将时间、日期组成一个datetime格式的时间</li>
</ul>
<p>datetime.year/month/day/hour/minute/second/microsecond/tzinfo</p>
<ul>
<li>获取datetime的部分时间信息</li>
</ul>
<p>datetime.date()/time()</p>
<ul>
<li>获取datetime的时间或日期信息</li>
</ul>
<p>datetime.weekday()</p>
<ul>
<li>返回时间对应的星期，星期一为0，星期天为6</li>
</ul>
<p>datetime.isoweekday()</p>
<ul>
<li>以整数形式返回星期，星期一为1，星期天为7</li>
</ul>
<h2 id="django-utils-timezone"><a href="#django-utils-timezone" class="headerlink" title="django.utils.timezone"></a>django.utils.timezone</h2><p>utc</p>
<ul>
<li>获取utc时区的tzinfo实例（可以赋值给tz）</li>
</ul>
<p>now()</p>
<ul>
<li>获取当前时间，使用时区为UTC时区</li>
</ul>
<p>get_current_timezone()</p>
<ul>
<li>获取本地时区的tzinfo实例</li>
</ul>
<p>localtime(value=None, timezone=None)</p>
<ul>
<li>将带时区的datetime转换为指定时区的datetime</li>
<li>value是带时区的datetime类型，默认为now()</li>
<li>timezone默认为本地时区</li>
</ul>
<p>localdate(value=None, timezone=None)</p>
<ul>
<li>将带时区的datetime转换为指定时区的date</li>
<li>value是带时区的datetime类型，默认为now()</li>
<li>timezone默认为本地时区</li>
</ul>
<p>is_aware(value)</p>
<ul>
<li>是否有时区，value为datetime类型，tzinfo不为None返回True</li>
</ul>
<p>is_naive(value)</p>
<ul>
<li>是否无时区，和is_aware相反</li>
</ul>
<p>make_aware(value, timezone=None, is_dst=None)</p>
<ul>
<li>将无时区的datetime转换为有时区的datetime，</li>
<li>value是一个没有时区的datetime类型，timezone为None则默认使用本地时区</li>
</ul>
<p>make_naive(value, timezone=None)</p>
<ul>
<li>将有时区的datetime转换为无时区的datetime</li>
<li>value是一个有时区的datetime，会先把时间转换到指定时区的时间，然后去除时区信息</li>
<li>timezone为None默认使用本地时区</li>
</ul>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="stolen"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">stolen</p>
  <div class="site-description" itemprop="description">一个热爱技术的Python开发者</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">44</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/stolenzc" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;stolenzc" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/3333060672" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;3333060672" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.stolenzc.com/" title="https:&#x2F;&#x2F;www.stolenzc.com" rel="noopener" target="_blank">个人网站</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://schedule.stolenzc.com/schedule/" title="https:&#x2F;&#x2F;schedule.stolenzc.com&#x2F;schedule&#x2F;" rel="noopener" target="_blank">日程管理</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://stolenzc.gitee.io/" title="https:&#x2F;&#x2F;stolenzc.gitee.io" rel="noopener" target="_blank">gitee主页</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">stolen</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">105k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">3:12</span>
</div>
  <div class="powered-by" style="display:none">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
